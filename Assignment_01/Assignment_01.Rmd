---
title: "Assignment 01"
author: "Qiushi"
date: "`r Sys.Date()`"
output: html_document
---


```{r}
library(data.table)
```

## Step 1.read in data and chek for issues

Reading in the 2004 data:
```{r read_data_1}
pm_04 <- data.table::fread("ad_viz_plotval_data_2004.csv")
pm_04
```
Reading in the 2019 data:
```{r read_data_2}
pm_19 <- data.table::fread("ad_viz_plotval_data_2019.csv")
pm_19
```
Check dimention:
```{r}
dim(pm_04)
dim(pm_19)
```

Check headers:
```{r}
head(pm_04)
head(pm_19)
```

Check footers:
```{r}
tail(pm_04)
tail(pm_19)
```

Check variable names and types:
```{r}
str(pm_04)
str(pm_19)
```
Check issues:
```{r}
summary(pm_04$`Daily Mean PM2.5 Concentration`)
summary(pm_19$`Daily Mean PM2.5 Concentration`)
table(is.na(pm_04))
table(is.na(pm_19))
```


Summary: The maximum PM2.5 concentration in 2004 is much more larger than that in 2019. The missing values are all in 13th column. The 13th column, "CBSA_CODE", seems not very important.

## Step 2. Combine the two years of data into one data frame. Use the Date variable to create a new column for year, which will serve as an identifier. Change the names of the key variables so that they are easier to refer to in your code.

Combine the two years of data into one data frame:
```{r combine_data}
library(dplyr)
pm <- rbind(pm_04, pm_19)
```

Use the Date variable to create a new column for year, which will serve as an identifier. Change the names of the key variables so that they are easier to refer to in your code.
```{r new_column}
pm <- mutate(pm, year = factor(rep(c(2004, 2019), c(nrow(pm_04), nrow(pm_19))))) %>%
  rename(PM = `Daily Mean PM2.5 Concentration`)
```

## Step 3. Create a basic map in leaflet() that shows the locations of the sites (make sure to use different colors for each year). Summarize the spatial distribution of the monitoring sites.
```{r leaflet}
library(leaflet)
year.pal <- colorFactor(c("blue","red"), domain = pm$year)



leaflet(pm) %>% 
  addProviderTiles("CartoDB.Positron") %>%
  addCircleMarkers(lat =~SITE_LATITUDE, lng = ~SITE_LONGITUDE, 
                   color = ~year.pal(year), stroke = FALSE, 
                   fillOpacity = 1, radius = 2) %>%
  addLegend("bottomleft", pal = year.pal, values = pm$year, title = "year")

```

Summary: Monitoring sites are densely distributed in coastal areas, and sparsely distributed in the inland areas.

## Step 4. Check for any missing or implausible values of PM2.5 in the combined dataset. Explore the proportions of each and provide a summary of any temporal patterns you see in these observations.



